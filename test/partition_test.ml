open! Combinat

let print c = print_s @@ [%sexp_of: int array] c

let%expect_test "partition-n<0" =
  require_does_raise [%here] (fun () -> partitions ~n:(-1) ~k:(-2) ignore);
  [%expect {|
    ("partition: expected n >= 0" (n -1)) |}]

let%expect_test "partition-k<0" =
  require_does_raise [%here] (fun () -> partitions ~n:2 ~k:(-1) ignore);
  [%expect {|
    ("partition: expected k >= 0" (k -1)) |}]

let%expect_test "partitions" =
  partitions ~n:0 ~k:0 print;
  [%expect {| () |}]

let%expect_test "partitions" = partitions ~n:1 ~k:0 print

let%expect_test "partitions" =
  for n = 1 to 10 do
    for k = 1 to n + 2 do
      print_s [%message (n : int) (k : int)];
      partitions ~n ~k print;
      [%expect
        {|
        (* CR expect_test: Collector ran multiple times with different outputs *)
        =========================================================================
        ((n 1)
         (k 1))
        (1)

        =========================================================================
        ((n 1)
         (k 2))

        =========================================================================
        ((n 1)
         (k 3))

        =========================================================================
        ((n 2)
         (k 1))
        (2)

        =========================================================================
        ((n 2)
         (k 2))
        (1 1)

        =========================================================================
        ((n 2)
         (k 3))

        =========================================================================
        ((n 2)
         (k 4))

        =========================================================================
        ((n 3)
         (k 1))
        (3)

        =========================================================================
        ((n 3)
         (k 2))
        (2 1)

        =========================================================================
        ((n 3)
         (k 3))
        (1 1 1)

        =========================================================================
        ((n 3)
         (k 4))

        =========================================================================
        ((n 3)
         (k 5))

        =========================================================================
        ((n 4)
         (k 1))
        (4)

        =========================================================================
        ((n 4)
         (k 2))
        (3 1)
        (2 2)

        =========================================================================
        ((n 4)
         (k 3))
        (2 1 1)

        =========================================================================
        ((n 4)
         (k 4))
        (1 1 1 1)

        =========================================================================
        ((n 4)
         (k 5))

        =========================================================================
        ((n 4)
         (k 6))

        =========================================================================
        ((n 5)
         (k 1))
        (5)

        =========================================================================
        ((n 5)
         (k 2))
        (4 1)
        (3 2)

        =========================================================================
        ((n 5)
         (k 3))
        (3 1 1)
        (2 2 1)

        =========================================================================
        ((n 5)
         (k 4))
        (2 1 1 1)

        =========================================================================
        ((n 5)
         (k 5))
        (1 1 1 1 1)

        =========================================================================
        ((n 5)
         (k 6))

        =========================================================================
        ((n 5)
         (k 7))

        =========================================================================
        ((n 6)
         (k 1))
        (6)

        =========================================================================
        ((n 6)
         (k 2))
        (5 1)
        (4 2)
        (3 3)

        =========================================================================
        ((n 6)
         (k 3))
        (4 1 1)
        (3 2 1)
        (2 2 2)

        =========================================================================
        ((n 6)
         (k 4))
        (3 1 1 1)
        (2 2 1 1)

        =========================================================================
        ((n 6)
         (k 5))
        (2 1 1 1 1)

        =========================================================================
        ((n 6)
         (k 6))
        (1 1 1 1 1 1)

        =========================================================================
        ((n 6)
         (k 7))

        =========================================================================
        ((n 6)
         (k 8))

        =========================================================================
        ((n 7)
         (k 1))
        (7)

        =========================================================================
        ((n 7)
         (k 2))
        (6 1)
        (5 2)
        (4 3)

        =========================================================================
        ((n 7)
         (k 3))
        (5 1 1)
        (4 2 1)
        (3 3 1)
        (3 2 2)

        =========================================================================
        ((n 7)
         (k 4))
        (4 1 1 1)
        (3 2 1 1)
        (2 2 2 1)

        =========================================================================
        ((n 7)
         (k 5))
        (3 1 1 1 1)
        (2 2 1 1 1)

        =========================================================================
        ((n 7)
         (k 6))
        (2 1 1 1 1 1)

        =========================================================================
        ((n 7)
         (k 7))
        (1 1 1 1 1 1 1)

        =========================================================================
        ((n 7)
         (k 8))

        =========================================================================
        ((n 7)
         (k 9))

        =========================================================================
        ((n 8)
         (k 1))
        (8)

        =========================================================================
        ((n 8)
         (k 2))
        (7 1)
        (6 2)
        (5 3)
        (4 4)

        =========================================================================
        ((n 8)
         (k 3))
        (6 1 1)
        (5 2 1)
        (4 3 1)
        (4 2 2)
        (3 3 2)

        =========================================================================
        ((n 8)
         (k 4))
        (5 1 1 1)
        (4 2 1 1)
        (3 3 1 1)
        (3 2 2 1)
        (2 2 2 2)

        =========================================================================
        ((n 8)
         (k 5))
        (4 1 1 1 1)
        (3 2 1 1 1)
        (2 2 2 1 1)

        =========================================================================
        ((n 8)
         (k 6))
        (3 1 1 1 1 1)
        (2 2 1 1 1 1)

        =========================================================================
        ((n 8)
         (k 7))
        (2 1 1 1 1 1 1)

        =========================================================================
        ((n 8)
         (k 8))
        (1 1 1 1 1 1 1 1)

        =========================================================================
        ((n 8)
         (k 9))

        =========================================================================
        ((n 8)
         (k 10))

        =========================================================================
        ((n 9)
         (k 1))
        (9)

        =========================================================================
        ((n 9)
         (k 2))
        (8 1)
        (7 2)
        (6 3)
        (5 4)

        =========================================================================
        ((n 9)
         (k 3))
        (7 1 1)
        (6 2 1)
        (5 3 1)
        (4 4 1)
        (5 2 2)
        (4 3 2)
        (3 3 3)

        =========================================================================
        ((n 9)
         (k 4))
        (6 1 1 1)
        (5 2 1 1)
        (4 3 1 1)
        (4 2 2 1)
        (3 3 2 1)
        (3 2 2 2)

        =========================================================================
        ((n 9)
         (k 5))
        (5 1 1 1 1)
        (4 2 1 1 1)
        (3 3 1 1 1)
        (3 2 2 1 1)
        (2 2 2 2 1)

        =========================================================================
        ((n 9)
         (k 6))
        (4 1 1 1 1 1)
        (3 2 1 1 1 1)
        (2 2 2 1 1 1)

        =========================================================================
        ((n 9)
         (k 7))
        (3 1 1 1 1 1 1)
        (2 2 1 1 1 1 1)

        =========================================================================
        ((n 9)
         (k 8))
        (2 1 1 1 1 1 1 1)

        =========================================================================
        ((n 9)
         (k 9))
        (1 1 1 1 1 1 1 1 1)

        =========================================================================
        ((n 9)
         (k 10))

        =========================================================================
        ((n 9)
         (k 11))

        =========================================================================
        ((n 10)
         (k 1))
        (10)

        =========================================================================
        ((n 10)
         (k 2))
        (9 1)
        (8 2)
        (7 3)
        (6 4)
        (5 5)

        =========================================================================
        ((n 10)
         (k 3))
        (8 1 1)
        (7 2 1)
        (6 3 1)
        (5 4 1)
        (6 2 2)
        (5 3 2)
        (4 4 2)
        (4 3 3)

        =========================================================================
        ((n 10)
         (k 4))
        (7 1 1 1)
        (6 2 1 1)
        (5 3 1 1)
        (4 4 1 1)
        (5 2 2 1)
        (4 3 2 1)
        (3 3 3 1)
        (4 2 2 2)
        (3 3 2 2)

        =========================================================================
        ((n 10)
         (k 5))
        (6 1 1 1 1)
        (5 2 1 1 1)
        (4 3 1 1 1)
        (4 2 2 1 1)
        (3 3 2 1 1)
        (3 2 2 2 1)
        (2 2 2 2 2)

        =========================================================================
        ((n 10)
         (k 6))
        (5 1 1 1 1 1)
        (4 2 1 1 1 1)
        (3 3 1 1 1 1)
        (3 2 2 1 1 1)
        (2 2 2 2 1 1)

        =========================================================================
        ((n 10)
         (k 7))
        (4 1 1 1 1 1 1)
        (3 2 1 1 1 1 1)
        (2 2 2 1 1 1 1)

        =========================================================================
        ((n 10)
         (k 8))
        (3 1 1 1 1 1 1 1)
        (2 2 1 1 1 1 1 1)

        =========================================================================
        ((n 10)
         (k 9))
        (2 1 1 1 1 1 1 1 1)

        =========================================================================
        ((n 10)
         (k 10))
        (1 1 1 1 1 1 1 1 1 1)

        =========================================================================
        ((n 10)
         (k 11))

        =========================================================================
        ((n 10)
         (k 12))|}]
    done
  done

let%expect_test "partitions_with_zeros n<0" =
  require_does_raise [%here] (fun () -> partitions_with_zeros ~n:(-1) ~k:(-2) ignore);
  [%expect {|
    ("partition_with_zeros: expected n >= 0" (n -1)) |}]

let%expect_test "partitions_with_zeros k<0" =
  require_does_raise [%here] (fun () -> partitions_with_zeros ~n:2 ~k:(-1) ignore);
  [%expect {|
    ("partition_with_zeros: expected k >= 0" (k -1)) |}]

let%expect_test "partitions_with_zeros" =
  for n = 1 to 6 do
    for k = 1 to n + 2 do
      print_s [%message (n : int) (k : int)];
      partitions_with_zeros ~n ~k print;
      [%expect {|
        (* CR expect_test: Collector ran multiple times with different outputs *)
        =========================================================================
        ((n 1)
         (k 1))
        (1)

        =========================================================================
        ((n 1)
         (k 2))
        (1 0)

        =========================================================================
        ((n 1)
         (k 3))
        (1 0 0)

        =========================================================================
        ((n 2)
         (k 1))
        (2)

        =========================================================================
        ((n 2)
         (k 2))
        (2 0)
        (1 1)

        =========================================================================
        ((n 2)
         (k 3))
        (2 0 0)
        (1 1 0)

        =========================================================================
        ((n 2)
         (k 4))
        (2 0 0 0)
        (1 1 0 0)

        =========================================================================
        ((n 3)
         (k 1))
        (3)

        =========================================================================
        ((n 3)
         (k 2))
        (3 0)
        (2 1)

        =========================================================================
        ((n 3)
         (k 3))
        (3 0 0)
        (2 1 0)
        (1 1 1)

        =========================================================================
        ((n 3)
         (k 4))
        (3 0 0 0)
        (2 1 0 0)
        (1 1 1 0)

        =========================================================================
        ((n 3)
         (k 5))
        (3 0 0 0 0)
        (2 1 0 0 0)
        (1 1 1 0 0)

        =========================================================================
        ((n 4)
         (k 1))
        (4)

        =========================================================================
        ((n 4)
         (k 2))
        (4 0)
        (3 1)
        (2 2)

        =========================================================================
        ((n 4)
         (k 3))
        (4 0 0)
        (3 1 0)
        (2 2 0)
        (2 1 1)

        =========================================================================
        ((n 4)
         (k 4))
        (4 0 0 0)
        (3 1 0 0)
        (2 2 0 0)
        (2 1 1 0)
        (1 1 1 1)

        =========================================================================
        ((n 4)
         (k 5))
        (4 0 0 0 0)
        (3 1 0 0 0)
        (2 2 0 0 0)
        (2 1 1 0 0)
        (1 1 1 1 0)

        =========================================================================
        ((n 4)
         (k 6))
        (4 0 0 0 0 0)
        (3 1 0 0 0 0)
        (2 2 0 0 0 0)
        (2 1 1 0 0 0)
        (1 1 1 1 0 0)

        =========================================================================
        ((n 5)
         (k 1))
        (5)

        =========================================================================
        ((n 5)
         (k 2))
        (5 0)
        (4 1)
        (3 2)

        =========================================================================
        ((n 5)
         (k 3))
        (5 0 0)
        (4 1 0)
        (3 2 0)
        (3 1 1)
        (2 2 1)

        =========================================================================
        ((n 5)
         (k 4))
        (5 0 0 0)
        (4 1 0 0)
        (3 2 0 0)
        (3 1 1 0)
        (2 2 1 0)
        (2 1 1 1)

        =========================================================================
        ((n 5)
         (k 5))
        (5 0 0 0 0)
        (4 1 0 0 0)
        (3 2 0 0 0)
        (3 1 1 0 0)
        (2 2 1 0 0)
        (2 1 1 1 0)
        (1 1 1 1 1)

        =========================================================================
        ((n 5)
         (k 6))
        (5 0 0 0 0 0)
        (4 1 0 0 0 0)
        (3 2 0 0 0 0)
        (3 1 1 0 0 0)
        (2 2 1 0 0 0)
        (2 1 1 1 0 0)
        (1 1 1 1 1 0)

        =========================================================================
        ((n 5)
         (k 7))
        (5 0 0 0 0 0 0)
        (4 1 0 0 0 0 0)
        (3 2 0 0 0 0 0)
        (3 1 1 0 0 0 0)
        (2 2 1 0 0 0 0)
        (2 1 1 1 0 0 0)
        (1 1 1 1 1 0 0)

        =========================================================================
        ((n 6)
         (k 1))
        (6)

        =========================================================================
        ((n 6)
         (k 2))
        (6 0)
        (5 1)
        (4 2)
        (3 3)

        =========================================================================
        ((n 6)
         (k 3))
        (6 0 0)
        (5 1 0)
        (4 2 0)
        (3 3 0)
        (4 1 1)
        (3 2 1)
        (2 2 2)

        =========================================================================
        ((n 6)
         (k 4))
        (6 0 0 0)
        (5 1 0 0)
        (4 2 0 0)
        (3 3 0 0)
        (4 1 1 0)
        (3 2 1 0)
        (2 2 2 0)
        (3 1 1 1)
        (2 2 1 1)

        =========================================================================
        ((n 6)
         (k 5))
        (6 0 0 0 0)
        (5 1 0 0 0)
        (4 2 0 0 0)
        (3 3 0 0 0)
        (4 1 1 0 0)
        (3 2 1 0 0)
        (2 2 2 0 0)
        (3 1 1 1 0)
        (2 2 1 1 0)
        (2 1 1 1 1)

        =========================================================================
        ((n 6)
         (k 6))
        (6 0 0 0 0 0)
        (5 1 0 0 0 0)
        (4 2 0 0 0 0)
        (3 3 0 0 0 0)
        (4 1 1 0 0 0)
        (3 2 1 0 0 0)
        (2 2 2 0 0 0)
        (3 1 1 1 0 0)
        (2 2 1 1 0 0)
        (2 1 1 1 1 0)
        (1 1 1 1 1 1)

        =========================================================================
        ((n 6)
         (k 7))
        (6 0 0 0 0 0 0)
        (5 1 0 0 0 0 0)
        (4 2 0 0 0 0 0)
        (3 3 0 0 0 0 0)
        (4 1 1 0 0 0 0)
        (3 2 1 0 0 0 0)
        (2 2 2 0 0 0 0)
        (3 1 1 1 0 0 0)
        (2 2 1 1 0 0 0)
        (2 1 1 1 1 0 0)
        (1 1 1 1 1 1 0)

        =========================================================================
        ((n 6)
         (k 8))
        (6 0 0 0 0 0 0 0)
        (5 1 0 0 0 0 0 0)
        (4 2 0 0 0 0 0 0)
        (3 3 0 0 0 0 0 0)
        (4 1 1 0 0 0 0 0)
        (3 2 1 0 0 0 0 0)
        (2 2 2 0 0 0 0 0)
        (3 1 1 1 0 0 0 0)
        (2 2 1 1 0 0 0 0)
        (2 1 1 1 1 0 0 0)
        (1 1 1 1 1 1 0 0) |}]
    done
  done
